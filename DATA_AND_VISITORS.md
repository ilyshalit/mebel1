# Данные и учёт посетителей

## Где хранятся данные

### Файлы (каталог, загрузки, результаты)

| Что | Где |
|-----|-----|
| **Каталог мебели** | `data/catalog.json` — названия, цены, типы, ссылки на фото |
| **Фото из каталога** | `data/catalog/*.png` |
| **Загруженные пользователями фото** (комната, мебель) | `data/uploads/` — сохраняются при загрузке через форму |
| **Сгенерированные визуализации** | `data/results/` — результаты работы ИИ |

### База данных визитов (SQLite)

| Что | Где |
|-----|-----|
| **База учёта обращений к API** | `data/visits.db` — один файл SQLite |

В таблицу `visits` пишется каждый запрос к любому endpoint вида `/api/*` (кроме `/api/admin/visits`): **IP**, **User-Agent**, **путь**, **метод**, **время (UTC)**. Так фиксируются все, кто соприкасался с сайтом через загрузку каталога, загрузку фото, генерацию и т.д.

Учётных записей пользователей (логин/пароль) по-прежнему нет: сервис анонимный.

---

## Где смотреть визиты

### 1. Страница «Визиты» в браузере (рекомендуется)

- Откройте в браузере: **`http://localhost:8080/admin.html`** (при локальном запуске) или **`https://ваш-домен/admin.html`**.
- Введите ключ доступа — значение переменной **`ADMIN_API_KEY`** из вашего `.env`.
- Нажмите «Загрузить визиты». Отобразится таблица: ID, время, IP, метод, путь, User-Agent.

Ключ нигде не светится в интерфейсе и не передаётся в URL при загрузке списка (только в заголовке запроса).

### 2. Через API вручную

```bash
curl -H "X-Admin-Key: ваш-ADMIN_API_KEY" "http://localhost:8000/api/admin/visits?limit=200"
```

Ответ: JSON с полем `visits` — массив записей.

### 3. Прямой просмотр БД (SQLite)

Файл: **`data/visits.db`**.

- **DB Browser for SQLite** ([sqlitebrowser.org](https://sqlitebrowser.org)) — бесплатная программа, открываете файл и смотрите таблицу `visits`.
- Или из терминала:  
  `sqlite3 data/visits.db "SELECT * FROM visits ORDER BY id DESC LIMIT 100;"`

При необходимости добавьте в `.gitignore` строку `data/visits.db`, чтобы не коммитить базу с визитами.

---

## Настройка

1. В **`.env`** задайте ключ для доступа к списку визитов (придумайте свой):  
   `ADMIN_API_KEY=придумайте-секретный-ключ`
2. В **`.env.example`** уже есть пример этой переменной — скопируйте в `.env` и замените значение.
3. После перезапуска backend таблица создаётся сама при первом запросе к API; файл `data/visits.db` появится автоматически.

---

## Логи сервера

В логах веб‑сервера (Nginx, Caddy) или backend (uvicorn) тоже есть IP, URL, User-Agent по каждому запросу. БД визитов дублирует учёт именно по обращениям к вашему API в одном месте (`data/visits.db`) и даёт удобный просмотр через админ-страницу или API.

---

## Юридическое

Обработка IP и технических данных при посещении сайта относится к персональным данным (152‑ФЗ). Цель и порядок обработки описаны в **Политике конфиденциальности** (`frontend/legal/privacy.html`). Рекомендуется не забывать обновлять политику при добавлении новых способов учёта (например, cookie или аналитики).

Правовые страницы вынесены в футер сайта; в них нужно подставить свои реквизиты (ИП/ООО, адрес, email).
